# 1 idea连接数据库时，找不到mysql驱动
出现这个bug有两种可能：
1. idea编译器自己找不到（不是项目找不到）依赖包。**标志是**，idea会报红，让你选是否在线下载驱动；
2. 项目的配置文件写错了，如poml或者yaml配置文件。**标志是**，代码出现ERROR。  

## 1.1 idea编译器自己找不到依赖包
在本地maven仓库找到依赖，然后点“+”号手动添加本地依赖。（让它自己下的话可能会出现外网访问慢，下载不了的问题）。  
<br/>

## 1.2 项目的配置文件写错了
该原因一般是使用框架创建项目时，框架默使用8.x版本的mysql驱动。所以驱动和配置文件中的数据库url需要统一起来（驱动和你电脑上装的mysql版本没关系）。

### 5.x版本使用的驱动和配置
驱动：
```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>5.x.x</version>
</dependency>
```
url和driverClass：
```yaml
url: jdbc:mysql://localhost:3306/你数据库的名字?useUnicode=true&characterEncoding=utf8&useSSL=false
driverClassName: com.mysql.jdbc.Driver
```
<br/>

### 6.x及以上版本使用的驱动和配置
驱动：
```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.x.x</version>
</dependency>
```
url和driverClass：
```yaml
url: jdbc:mysql://localhost:3306/你数据库的名字?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf8&useSSL=false
driverClassName: com.mysql.cj.jdbc.Driver
```
<br/><br/><br/>




# 2 多模块项目之间代码依赖的问题
>吐槽一下java的报错机制，非得把报错信息挤在一行，“;”号之后加个回车就不会成一坨了，非要挤在一起让人看着难受。  

报错如下：
```java
ERROR 30808 --- [           main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'articleController': Injection of resource dependencies failed; 
nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'articleService': Unsatisfied dependency expressed through field 'baseMapper'; 
nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'com.example.mapper.ArticleMapper' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
```

大概意思是：Spring在创建articleService对象时（UnsatisfiedDependencyException），找不到（NoSuchBeanDefinitionException）ArticleMapper的定义。

原因：java和C++一样都是编译型语言，所以java也需要一个类似 java代码——>代码编译后生成的文件（**由maven执行，生成的文件都在target目录下**）——>可执行文件 的过程。如果跑代码时，编译时中间文件没有更新，那么你跑的其实是没改之前代码。

解决：在idea中选择“clear install”或者“install”，让maven重新编译代码。
<br/><br/><br/>




# 3 跨域问题
- 原因：浏览器使用了同源策略。同源是指 "协议+域名+端口"三者相同，**即便两个不同的域名指向同一个 ip 地址，也非同源**。  
- 为何使用同源策略：防止 攻击者盗用你的身份信息（cookie等），然后用你的名义发送恶意请求，从而盗用了你的信息（CSRF）。  
- 触发同源策略的原因：网站A的代码中，用到了B服务器的资源，A和B不同源。  
<br/>


## 3.1 jsonp解决（绕开浏览器，直接调用HTTP接口）
原理：同源策略限制了绝大多数的非同源请求，但没限制js的 script标签的src属性和iframe标签 发送跨域请求。  

具体做法：
1. 前端在目标url后添加 "?callback=fun"，fun是前端定义和实现的一个函数；  
2. 后端以返回值的形式调用fun函数，比如返回“fun(parm1, param2)”。pram1和pram2的值由服务器决定，是json格式。页面拿到这个返回值后，就会把它当多js代码来执行。  

优点：
1. 兼容 更加古老的浏览器，不需要XMLHttpRequest或ActiveX的支持  
2. 页面只要处理jsonp服务返回的数据就行了，前后端分离  

缺点：
1. 安全性较低。攻击者只要找到script标签里调用jsonp服务的url，就能伪装成你发送请求获取服务器的数据了（连cookie都不用带了，嘿嘿）。  
2. 只支持GET请求
3. 调用失败的时候不会返回各种HTTP状态码。 

适用范围：古老浏览器 或者 私密性不强的数据。  
<br/>


## 3.2 对资源服务器进行设置（绕不开浏览器，那就按CORS的要求来做）
```java
//告诉spring这是配置类，要加载这里的配置
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        // 要处理的请求地址，“**”表示匹配所有路径
        registry.addMapping("/**")
                // 设置允许跨域请求的域名
                .allowedOriginPatterns("*")
                // 是否允许cookie（当然，前端发不发是另外一回事）
                .allowCredentials(true)
                // 设置允许的请求方式
                .allowedMethods("GET", "POST", "DELETE", "PUT")
                // 设置允许的header属性
                .allowedHeaders("*")
                // 跨域允许时间
                .maxAge(3600);
    }
}
```

对于简单请求：服务器 需要在响应头中设置Access-Control-Allow-Origin字段的值，该字段用于表明 **当前资源可被哪些外域访问**。  
原理：当浏览器收到这样的响应头信息之后，会提取出Access-Control-Allow-Origin字段中的值，如果发现该值包含当前页面所在的域，浏览器就会**把响应数据暴露给前端代码**。  

对于复杂请求：服务器 需要处理OPTIONS方式的预请求——在该请求的响应信息中告诉客户端 自己的跨域策略。
原理：
- addMapping("/**")：设置url拦截规则，“\*\*”表示匹配所有；  
- allowedOrigins("*")：设置 Access-Control-Allow-Origin 头字段的值为“\*”，表示匹配所有域；  
- allowedMethods("POST", "GET")：设置 Access-Control-Allow-Methods 头字段的值，指定接受的请求方式；
- allowCredentials(true)：......，告诉客户端是否可以发送cookie（真发送起来还得 AJAX请求中的withCredentials属性打开）；
- allowedHeaders("*")：支持哪些头字段，可添加自定义头字段；  
- maxAge(3600)：持续时间。
<br/>


## 3.3 nginx代理解决
跨域过程：
1. 浏览器访问NGINX代理服务器上的一个页面，如 http://192.168.1.1/index.html（可能要设置Access-Control-Allow-Origin的值？）；  
2. 该页面需要访问一个同源地址，如 http://192.168.1.1/api； 
3. 在NGINX上设置url的映射路径——把本地一个url前缀映射到要跨域访问的web服务器上（人为设置）；  
4. NGINX发现 http://192.168.1.1/api 匹配上了“/api”，然后就向对应的web发送请求，然后把数据返回给 http://192.168.1.1/index.html；
5. http://192.168.1.1/index.html 把信息返回给浏览器，跨域结束。
<br/><br/><br/>




# 4 项目配置
## 4.1 pom文件中添加maven插件
一些插件是要跟着 启动类/main方法 走的，比如spring-boot-maven-plugin。因为这些插件会自动寻找 该pom文件所在模块的启动类，没找到就会报错。spring-boot-maven-plugin

## 4.2 [mybatis-plus与mybatis共存设置](https://blog.csdn.net/helloworldchina/article/details/121278896)
<br/><br/><br/>



# 5 权限验证
问题原因：数据库中没有给管理员账号，需要自己手动添加。但是代码使用了权限验证shiro，管理员的账号密码是加密后存入数据库的——手动添加的密码得是加密后的密码才能成功登录。  

解决：最终在shiro的配置类中找到了加密方式——md5（1024）+ 盐值（用户名）。使用shiro的加密函数对明文密码进行加密，之后把加密后的密码存入数据库中。    





create table Student(Sno char(9) primary key,Sname char(20) not null,Ssex char(2),Sage smallint,Sdept char(20));
create table Course(Cno char(4) primary key,Cname char(40) not null,Cpno char(4) references Course(Cno),Ccredit smallint);
create table SC(Sno char(9),Cno char(4),Grade smallint,primary key(Sno,Cno),foreign key(Sno) references Student(Sno),foreign key (Cno) references Course(Cno));

insert into Student(Sno,Sname,Ssex,Sage,Sdept)values('201215121','李勇','男','20','CS');
insert into Student(Sno,Sname,Ssex,Sage,Sdept)values('201215122','刘晨','女','19','CS');
insert into Student(Sno,Sname,Ssex,Sage,Sdept)values('201215123','王敏','女','18','MA');
insert into Student(Sno,Sname,Ssex,Sage,Sdept)values('201215125','张立','男','19','IS');

insert into Course(Cno,Cname,Cpno,Ccredit)values('1','数据库','5','4');
insert into Course(Cno,Cname,Cpno,Ccredit)values('2','数学','null','2');
insert into Course(Cno,Cname,Cpno,Ccredit)values('3','信息系统','1','4');
insert into Course(Cno,Cname,Cpno,Ccredit)values('4','操作系统','6','3');
insert into Course(Cno,Cname,Cpno,Ccredit)values('5','数据结构','7','4');
insert into Course(Cno,Cname,Cpno,Ccredit)values('6','数据处理','null','2');
insert into Course(Cno,Cname,Cpno,Ccredit)values('7','PASCLA语言','6','4');

insert into SC(Sno,Cno,Grade)values('201215121','1','92');
insert into SC(Sno,Cno,Grade)values('201215121','2','85');
insert into SC(Sno,Cno,Grade)values('201215121','3','88');
insert into SC(Sno,Cno,Grade)values('201215122','2','90');
insert into SC(Sno,Cno,Grade)values('201215122','3','80');

